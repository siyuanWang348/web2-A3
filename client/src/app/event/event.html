<app-navbar></app-navbar>

<!-- 主内容区 -->
<div class="container event-page">
  <h1>📌 Event Details</h1>

  <!-- 手动输入ID调试 -->
  <div class="manual-entry" *ngIf="!event && !error">
    <p><strong>Debug Tool:</strong> If event details don't load automatically, enter event ID manually:</p>
    <input type="number" #manualId placeholder="Enter event ID">
    <button class="btn secondary" (click)="loadEventByManualId(manualId)">Load Event</button>
  </div>

  <!-- 错误显示 -->
  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- 加载成功 -->
  <div *ngIf="event" class="detail-card">
    <div class="event-card">
      <h2>{{ event.title || 'N/A' }}</h2>

      <div class="event-info">
        <p><strong>Date:</strong> {{ formatDate(event.event_date) }}</p>
        <p><strong>Location:</strong> {{ event.location || 'N/A' }}</p>
        <p><strong>Category:</strong> {{ event.category_name || 'N/A' }}</p>
        <p><strong>Organization:</strong> {{ event.org_name || 'N/A' }}</p>
        <p><strong>Contact:</strong> {{ event.contact_email || 'N/A' }}, {{ event.contact_phone || 'N/A' }}</p>
      </div>

      <p class="desc">{{ event.description || 'N/A' }}</p>

      <div class="goal-section">
        <p>
          <strong>🎯 Goal:</strong> ${{ event.charity_goal ?? 'N/A' }} |
          <strong>Progress:</strong> ${{ event.current_progress ?? 'N/A' }}
        </p>
        <div class="progress-bar">
          <div
            class="progress-fill"
            [style.width.%]="calculateProgress(event.current_progress, event.charity_goal)"
          ></div>
        </div>
      </div>

      <p><strong>Ticket Price:</strong> ${{ event.ticket_price ?? 'N/A' }}</p>

      <button class="btn primary">Register</button>

      <h3>Registrations ({{ event.registrations?.length || 0 }})</h3>
      <table *ngIf="event.registrations?.length > 0" border="1" cellpadding="5">
        <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Tickets</th>
          <th>Notes</th>
          <th>Registered At</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let reg of event.registrations">
          <td>{{ reg.user_name }}</td>
          <td>{{ reg.user_email }}</td>
          <td>{{ reg.user_phone }}</td>
          <td>{{ reg.tickets }}</td>
          <td>{{ reg.notes }}</td>
          <td>{{ reg.registered_at | date:'short' }}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-footer></app-footer>
